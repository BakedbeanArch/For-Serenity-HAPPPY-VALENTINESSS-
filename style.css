:root {
    --gold: #f3cf7a;
    --soft-white: #fdfbf7;
    --bg-dark: #05070a;
    --accent-glow: rgba(243, 207, 122, 0.3);
    --ease-cinematic: cubic-bezier(0.4, 0, 0.2, 1);
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body, html {
    margin: 0; padding: 0; width: 100%; height: 100%;
    background: var(--bg-dark); color: var(--soft-white);
    font-family: 'Playfair Display', serif; overflow: hidden;
    touch-action: none; /* Prevent accidental zoom/scroll on mobile */
}

/* Starfield & Parallax */
#starfield {
    position: fixed; inset: 0; z-index: -1;
    background: radial-gradient(circle at center, #0a1128 0%, #05070a 100%);
    perspective: 1000px;
}

.star {
    position: absolute; background: white; border-radius: 50%;
    animation: twinkle var(--d) ease-in-out infinite;
    will-change: opacity, transform;
}

@keyframes twinkle { 
    0%, 100% { opacity: 0.2; transform: scale(1); } 
    50% { opacity: 0.8; transform: scale(1.2); } 
}

/* Cinematic Bloom Layer */
#bloom-layer {
    position: fixed; inset: 0; pointer-events: none;
    background: radial-gradient(circle at 50% 50%, var(--accent-glow) 0%, transparent 70%);
    opacity: 0; transition: opacity 3s ease; z-index: 10;
}

/* Scene Transitions */
.scene {
    position: absolute; inset: 0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    opacity: 0; visibility: hidden; 
    transition: opacity 1.5s var(--ease-cinematic), transform 1.5s var(--ease-cinematic);
    padding: calc(20px + var(--safe-top)) 20px calc(20px + var(--safe-bottom));
    transform: scale(1.05);
}

.scene.active { opacity: 1; visibility: visible; transform: scale(1); }

/* Intro Hero Star (Pixar Inspired) */
.star-hero {
    width: 8px; height: 8px; background: var(--soft-white); border-radius: 50%;
    box-shadow: 0 0 30px 10px var(--soft-white); opacity: 0;
    transition: all 1.5s var(--ease-cinematic);
}

.cinematic-title { font-size: clamp(2rem, 8vw, 3.5rem); margin-bottom: 0.5rem; text-align: center; letter-spacing: 4px; }
.cinematic-subtitle { font-family: 'Great Vibes', cursive; font-size: 1.8rem; color: var(--gold); margin-bottom: 2rem; }

/* Constellation Bar (SERENITY) */
.constellation-bar {
    display: flex; justify-content: center; gap: 10px;
    padding: 20px 0; flex-wrap: wrap;
}

.constellation-bar span {
    font-size: clamp(1.5rem, 5vw, 2.5rem); opacity: 0.1; transition: all 1.2s ease;
    text-shadow: 0 0 10px transparent; font-weight: bold; cursor: pointer;
}

.constellation-bar span.lit {
    opacity: 1; color: var(--gold); text-shadow: 0 0 20px var(--gold);
    animation: letterPulse 2s infinite alternate;
}

@keyframes letterPulse { from { transform: scale(1); } to { transform: scale(1.1); } }

/* Photo Grid */
.photo-grid {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 12px; overflow-y: auto; padding: 10px;
    flex-grow: 1; width: 100%; max-width: 800px;
    mask-image: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
}

@media (min-width: 768px) { .photo-grid { grid-template-columns: repeat(4, 1fr); gap: 20px; } }

.photo-card {
    aspect-ratio: 1/1; position: relative; border-radius: 12px;
    overflow: hidden; background: #111; transform: translateZ(0);
    transition: transform 0.4s var(--ease-cinematic);
}

.photo-card.unlocked:active { transform: scale(0.95); }
.photo-card img { width: 100%; height: 100%; object-fit: cover; transition: 0.8s; }
.photo-card.locked img { filter: grayscale(1) brightness(0.2) blur(5px); }

.lock-icon { 
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
    color: var(--gold); font-size: 1.5rem; opacity: 0.5;
}

/* Lightbox */
#lightbox {
    position: fixed; inset: 0; z-index: 2000; 
    display: flex; align-items: center; justify-content: center;
    transition: opacity 0.5s ease;
}

.lightbox-overlay { 
    position: absolute; inset: 0; 
    background: rgba(0,0,0,0.92); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
}

.lightbox-window { 
    position: relative; width: 85vw; max-width: 450px; 
    z-index: 2001; animation: lbIn 0.6s var(--ease-cinematic);
}

@keyframes lbIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }

.img-frame { 
    border-radius: 15px; overflow: hidden; 
    box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1);
}
#lightbox-img { width: 100%; height: auto; display: block; }

.ui-overlay { padding: 20px; text-align: center; }
#lightbox-caption { font-size: 1.2rem; margin-bottom: 15px; font-style: italic; color: var(--gold); }

/* Audio Visualizer Mimic */
.audio-visualizer { display: flex; justify-content: center; gap: 4px; height: 20px; margin-bottom: 10px; }
.bar { width: 3px; background: var(--gold); border-radius: 2px; }
.playing .bar { animation: barGrow 0.5s ease-in-out infinite alternate; }
.bar:nth-child(2) { animation-delay: 0.2s; }
.bar:nth-child(3) { animation-delay: 0.4s; }
@keyframes barGrow { from { height: 5px; } to { height: 20px; } }

/* Buttons */
.glow-button {
    background: transparent; border: 1px solid var(--gold); color: var(--gold);
    padding: 16px 40px; font-size: 0.9rem; border-radius: 50px; cursor: pointer;
    transition: 0.4s; text-transform: uppercase; letter-spacing: 3px;
    box-shadow: 0 0 15px var(--accent-glow);
}

.glow-button:active { background: var(--gold); color: black; transform: scale(0.98); }

.outline-button { 
    background: transparent; border: 1px solid rgba(255,255,255,0.3); color: white; 
    padding: 16px 40px; border-radius: 50px; cursor: pointer;
}

.hidden { display: none !important; }
.instruction-text { font-size: 0.8rem; opacity: 0.5; margin-top: -10px; margin-bottom: 20px; letter-spacing: 1px; }

/* Final Scene */
#valentine-question { font-size: clamp(1.8rem, 6vw, 3rem); text-align: center; min-height: 4rem; margin: 20px 0; }
#decision-buttons { display: flex; gap: 20px; }
